---
title: "fia_tree_density"
author: "Leana Goetze"
date: "11/8/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
```

# notes about calculating tree density
```{r}
# nonhex/intensified plots: "In 2011, the FIA program established intensified plots in several of the Experimental Forests and Ranges (EFRs). These plots resemble standard FIA phase 2 plots as described in Bechtold et al. (2005), but they are much denser per unit area, with roughly 50 plots in each EFR."--> Leana is assuming nonhex plots are the same size as the hex plots
# https://www.fs.fed.us/pnw/pubs/pnw_gtr931/pnw_gtr931_076.pdf

# hex plots: Acres per plot = 0.166166884 acres per plot = 672.4535217056 m^2 = .067245 hectares (this is confirmed in https://esajournals.onlinelibrary.wiley.com/doi/10.1890/ES14-00103.1)
#https://www.fia.fs.fed.us/library/database-documentation/historic/ver6/FIADB%20User%20Guide%20P2_6-0-2_final-opt.pdf
```

# attach packages
```{r}
library(tidyverse)
library(ggplot2) #not sure if this is actually needed
library(dplyr)
```

### FIA

# read in fia data and wrangle into desired format (fia)
```{r}
# read in fiadata 
fia_data_raw_unfiltered <-read_csv(here::here("FINAL_FIA_DATA", "final_binded_fia_ypmc_data.csv"))

# filter for dbh > 4 inches (10.16 cm)
fia_data_raw <- fia_data_raw_unfiltered %>% 
filter(dbh >= 10.16)
```

# total tree density (fia)
```{r}
# wrangle data
fia_data_species <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species)%>% 
  group_by(plotkey,species) %>% 
  tally()

fia_data <- fia_data_species %>% 
  group_by(plotkey)%>% 
  tally(n)
# n = total number of trees (ypmc > 4 inches) in the plot
##------------------------------------------------------------------------------------

# multiply n by (1/.067245) to convert to trees/hectare instead of trees/.06725 hecare
fia_density<- fia_data %>% 
  mutate(tree_per_hectare = (n * (1/0.067245)))

# find the average of trees_per_hectare column
mean(fia_density$tree_per_hectare)
median(fia_density$tree_per_hectare)
# mean 367.3136
# median 327.1619

# create new dataframe 
total_density <- data.frame("FIA plots", mean(fia_density$tree_per_hectare), median(fia_density$tree_per_hectare)) %>% 
  rename ("plots" = "X.FIA.plots.", "mean" = "mean.fia_density.tree_per_hectare.", "median" = "median.fia_density.tree_per_hectare.")
##------------------------------------------------------------------------------------

# graph
ggplot(total_density , aes(x = plots, y = mean))+
  geom_col(show.legend = FALSE, fill = "#9A2130", width = 0.2) +
  geom_text(aes(label = round(mean, 1)), vjust = -0.5)+
  geom_point(aes(x = plots, y = median)) +
  theme_bw()+
  labs(title = "YPMC Tree Density", x = "", y = "Trees/Hectare") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 400))
```

# tree density by species (fia)
```{r}
# check how many plots each species was present in
fia_species_check <-fia_data_species %>% 
  group_by(species) %>% 
  tally()
 # pipo only in 16 plots --> group with pije and name "yellow pine" (also b/c of errors in vtm tree identification)
##------------------------------------------------------------------------------------

# yellow pine
fia_species_yp<- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species)%>% 
  group_by(plotkey,species)%>% 
  tally()%>% 
  filter(species %in% c("PIPO", "PIJE")) %>% 
  group_by(plotkey) %>% 
  tally(n)%>% ## this extra code is needed here, because there are two species and therefore the plotkey could be duplicated
  mutate(yp_per_hectare = (n * (1/0.067245)))

mean(fia_species_yp$yp_per_hectare)
median(fia_species_yp$yp_per_hectare)
# 122.6637
# 74.35497

# create new dataframe --> join this with all other species dataframes later
total_yp_density <- data.frame("Yellow Pine", mean(fia_species_yp$yp_per_hectare), median(fia_species_yp$yp_per_hectare)) %>% 
  rename ("plots" = "X.Yellow.Pine.", "mean trees/hectare" = "mean.fia_species_yp.yp_per_hectare.", "median trees/hectare" = "median.fia_species_yp.yp_per_hectare.")
##------------------------------------------------------------------------------------

#pipo
# note: this is not included in the final data
fia_species_pipo <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species)%>% 
  group_by(plotkey,species)%>% 
  tally()%>% 
  filter(species == "PIPO") %>% 
  mutate(pipo_per_hectare = (n * (1/0.067245)))

mean(fia_species_pipo$pipo_per_hectare)
median(fia_species_pipo$pipo_per_hectare)
# 87.36709
# 52.04848

# create new dataframe --> join this with all other species dataframes later
total_pipo_density <- data.frame("pipo", mean(fia_species_pipo$pipo_per_hectare), median(fia_species_pipo$pipo_per_hectare)) %>% 
  rename ("plots" = "X.pipo.", "mean trees/hectare" = "mean.fia_species_pipo.pipo_per_hectare.", "median trees/hectare" = "median.fia_species_pipo.pipo_per_hectare.")
##------------------------------------------------------------------------------------

# pije
# note: this is not included in the final data
fia_species_pije <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species) %>% 
  group_by(plotkey,species) %>% 
  tally() %>% 
  filter(species == "PIJE") %>% 
  mutate(pije_per_hectare = (n * (1/0.067245)))

mean(fia_species_pije$pije_per_hectare)
median(fia_species_pije$pije_per_hectare)
# 124.7245
# 74.35497

# create new dataframe --> join this with all other species dataframes later
total_pije_density <- data.frame("pije", mean(fia_species_pije$pije_per_hectare), median(fia_species_pije$pije_per_hectare)) %>% 
  rename ("plots" = "X.pije.", "mean trees/hectare" = "mean.fia_species_pije.pije_per_hectare.", "median trees/hectare" = "median.fia_species_pije.pije_per_hectare.")
##------------------------------------------------------------------------------------

# abco
fia_species_abco <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species) %>% 
  group_by(plotkey,species) %>% 
  tally() %>% 
  filter(species == "ABCO") %>% 
  mutate(abco_per_hectare = (n * (1/0.067245)))

mean(fia_species_abco$abco_per_hectare)
median(fia_species_abco$abco_per_hectare)
# 148.9803
# 89.22596

# create new dataframe --> join this with all other species dataframes later
total_abco_density <- data.frame("abco", mean(fia_species_abco$abco_per_hectare), median(fia_species_abco$abco_per_hectare)) %>% 
  rename ("plots" = "X.abco.", "mean trees/hectare" = "mean.fia_species_abco.abco_per_hectare.", "median trees/hectare" = "median.fia_species_abco.abco_per_hectare.")
##------------------------------------------------------------------------------------

# pila
fia_species_pila <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species) %>% 
  group_by(plotkey,species) %>% 
  tally() %>% 
  filter(species == "PILA") %>% 
  mutate(pila_per_hectare = (n * (1/0.067245)))

mean(fia_species_pila$pila_per_hectare)
median(fia_species_pila$pila_per_hectare)
# 56.00764
# 29.74199

# create new dataframe --> join this with all other species dataframes later
total_pila_density <- data.frame("pila", mean(fia_species_pila$pila_per_hectare), median(fia_species_pila$pila_per_hectare)) %>% 
  rename ("plots" = "X.pila.", "mean trees/hectare" = "mean.fia_species_pila.pila_per_hectare.", "median trees/hectare" = "median.fia_species_pila.pila_per_hectare.")
##------------------------------------------------------------------------------------

# quch
fia_species_quch <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species) %>% 
  group_by(plotkey,species) %>% 
  tally() %>% 
  filter(species == "QUCH") %>% 
  mutate(quch_per_hectare = (n * (1/0.067245)))

mean(fia_species_quch$quch_per_hectare)
median(fia_species_quch$quch_per_hectare)
# 228.8967
# 148.7099

# create new dataframe --> join this with all other species dataframes later
total_quch_density <- data.frame("quch", mean(fia_species_quch$quch_per_hectare), median(fia_species_quch$quch_per_hectare)) %>% 
  rename ("plots" = "X.quch.", "mean trees/hectare" = "mean.fia_species_quch.quch_per_hectare.", "median trees/hectare" = "median.fia_species_quch.quch_per_hectare.")
##------------------------------------------------------------------------------------

# cade
fia_species_cade <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species) %>% 
  group_by(plotkey,species) %>% 
  tally() %>% 
  filter(species == "CADE") %>% 
  mutate(cade_per_hectare = (n * (1/0.067245)))

mean(fia_species_cade$cade_per_hectare)
median(fia_species_cade$cade_per_hectare)
# 81.27171
# 44.61298

# create new dataframe --> join this with all other species dataframes later
total_cade_density <- data.frame("cade", mean(fia_species_cade$cade_per_hectare), median(fia_species_cade$cade_per_hectare)) %>% 
  rename ("plots" = "X.cade.", "mean trees/hectare" = "mean.fia_species_cade.cade_per_hectare.", "median trees/hectare" = "median.fia_species_cade.cade_per_hectare.")
##------------------------------------------------------------------------------------

# psma
# note: this is not included in final data because there are less than 20 plots with psma in vtm data
fia_species_psma <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species) %>% 
  group_by(plotkey,species) %>% 
  tally() %>% 
  filter(species == "PSMA") %>% 
  mutate(psma_per_hectare = (n * (1/0.067245)))

mean(fia_species_psma$psma_per_hectare)
median(fia_species_psma$psma_per_hectare)
# 72.4961
# 52.04848

# create new dataframe --> join this with all other species dataframes later
total_psma_density <- data.frame("psma", mean(fia_species_psma$psma_per_hectare), median(fia_species_psma$psma_per_hectare)) %>% 
  rename ("plots" = "X.psma.", "mean trees/hectare" = "mean.fia_species_psma.psma_per_hectare.", "median trees/hectare" = "median.fia_species_psma.psma_per_hectare.")
##------------------------------------------------------------------------------------

# quke
fia_species_quke <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species) %>% 
  group_by(plotkey,species) %>% 
  tally() %>% 
  filter(species == "QUKE") %>% 
  mutate(quke_per_hectare = (n * (1/0.067245)))

mean(fia_species_quke$quke_per_hectare)
median(fia_species_quke$quke_per_hectare)
# 124.3756
# 104.097

# create new dataframe --> join this with all other species dataframes later
total_quke_density <- data.frame("quke", mean(fia_species_quke$quke_per_hectare), median(fia_species_quke$quke_per_hectare)) %>% 
  rename ("plots" = "X.quke.", "mean trees/hectare" = "mean.fia_species_quke.quke_per_hectare.", "median trees/hectare" = "median.fia_species_quke.quke_per_hectare.")
##------------------------------------------------------------------------------------

# pico
fia_species_pico <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species) %>% 
  group_by(plotkey,species) %>% 
  tally() %>% 
  filter(species == "PICO") %>% 
  mutate(pico_per_hectare = (n * (1/0.067245)))

mean(fia_species_pico$pico_per_hectare)
median(fia_species_pico$pico_per_hectare)
# 66.02721
# 59.48398

# create new dataframe --> join this with all other species dataframes later
total_pico_density <- data.frame("pico", mean(fia_species_pico$pico_per_hectare), median(fia_species_pico$pico_per_hectare)) %>% 
  rename ("plots" = "X.pico.", "mean trees/hectare" = "mean.fia_species_pico.pico_per_hectare.", "median trees/hectare" = "median.fia_species_pico.pico_per_hectare.")
##------------------------------------------------------------------------------------

# join all species dataframes 
# notet: we are not including psma or pipo/pije. pipo/pije are captured under "yellow pine"
species_densities <- total_abco_density %>% 
  full_join(total_cade_density) %>% 
  full_join(total_pico_density) %>% 
  full_join(total_pila_density) %>% 
  full_join(total_quch_density) %>%
  full_join(total_quke_density) %>% 
  full_join(total_yp_density) %>% 
  rename("mean" = "mean trees/hectare", "median" = "median trees/hectare")
##------------------------------------------------------------------------------------

# graph species densities
ggplot(species_densities, aes(x = plots, y = mean))+
  geom_col(show.legend = FALSE, fill = "#237473", width = 0.5) +
  geom_text(aes(label = round(mean, 0)), vjust = -0.5)+
  geom_point(aes(x = plots, y = median)) +
  theme_bw()+
  labs(title = "YPMC Species Tree Density", x = "Species", y = "Trees/Hectare") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 250))
```

# tree density by genus (fia)
```{r}
# oak
fia_species_oak <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species)%>% 
  group_by(plotkey,species) %>% 
  tally()%>% 
  filter(species %in% c("QUCH", "QUKE"))%>% 
  group_by(plotkey) %>% 
  tally(n) %>% 
  mutate(oak_per_hectare = (n * (1/0.067245))) 
  
mean(fia_species_oak$oak_per_hectare)
median(fia_species_oak$oak_per_hectare)
# 230.5599
# 148.7099

# create new dataframe 
total_oak_density <- data.frame("oak", mean(fia_species_oak$oak_per_hectare), median(fia_species_oak$oak_per_hectare)) %>% 
  rename ("plots" = "X.oak.", "mean trees/hectare" = "mean.fia_species_oak.oak_per_hectare.", "median trees/hectare" = "median.fia_species_oak.oak_per_hectare.")
##------------------------------------------------------------------------------------

# pine
fia_species_pine <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species)%>% 
  group_by(plotkey,species) %>% 
  tally() %>% 
  filter(!species %in% c("QUCH", "QUKE")) %>% 
  group_by(plotkey) %>% 
  tally(n) %>% 
  mutate(pine_per_hectare = (n * (1/0.067245))) 
  
mean(fia_species_pine$pine_per_hectare)
median(fia_species_pine$pine_per_hectare)
# 230.0755
# 178.4519

# create new dataframe 
total_pine_density <- data.frame("pine", mean(fia_species_pine$pine_per_hectare), median(fia_species_pine$pine_per_hectare)) %>% 
  rename ("plots" = "X.pine.", "mean trees/hectare" = "mean.fia_species_pine.pine_per_hectare.", "median trees/hectare" = "median.fia_species_pine.pine_per_hectare.")

# join all species dataframes 
oak_pine_densities <- total_oak_density %>% 
  full_join(total_pine_density) %>% 
  rename("mean" = "mean trees/hectare", "median" = "median trees/hectare")
##------------------------------------------------------------------------------------

# graph oak/pine densities
ggplot(oak_pine_densities, aes(x = plots, y = mean))+
  geom_col(show.legend = FALSE, fill = "#207735", width = 0.3) +
  geom_text(aes(label = round(mean, 1)), vjust = -0.5)+
  geom_point(aes(x = plots, y = median)) +
  theme_bw()+
  labs(title = "Oak/Pine Tree Density", x = "Classification", y = "Trees/Hectare") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 250))

```

# tree density by shade tolerant/intolerant (fia)
```{r}
# Shade Tolerant species: PILA, ABCO, CADE, QUCH
# Shade Intolerant species: PIPO, PIJE, PICO, PSMA, QUKE

# Note:unsure if this is how the final species list for shade tolerant and intolerant will look like 
##------------------------------------------------------------------------------------ 

# create a column for shade tolerant. 
# 1 = yes, shade tolerant. 
# 0 = no, shade intolerant
fia_shade <- fia_data_raw %>%
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey, species) %>% 
  mutate(shade_tolerant = ifelse(species %in% c("PILA",
                                                     "ABCO",
                                                     "CADE",
                                                     "QUCH"), "1",
                                 ifelse(species %in% c("PIPO",
                                                            "PIJE",
                                                            "PICO",
                                                            "PSMA",
                                                            "QUKE"), "0", "NA"))) %>%
  group_by(plotkey, shade_tolerant) %>%
  tally()
##------------------------------------------------------------------------------------ 

# find shade-tolerant density
fia_shade_tolerant <- fia_shade %>%
  filter(shade_tolerant == "1") %>%
  mutate(plot_per_hectare = (n * (1/0.0809)))

mean(fia_shade_tolerant$plot_per_hectare)
median(fia_shade_tolerant$plot_per_hectare)
##------------------------------------------------------------------------------------ 

# find shade-intolerant density
fia_shade_intolerant <- fia_shade %>%
  filter(shade_tolerant == "0") %>%
  mutate(plot_per_hectare = (n * (1/0.0809)))

mean(fia_shade_intolerant$plot_per_hectare)
median(fia_shade_intolerant$plot_per_hectare)
##------------------------------------------------------------------------------------ 

# make dataframes 
fia_tolerant <- data.frame("fia_shade_tolerant", mean(fia_shade_tolerant$plot_per_hectare), 
                      median(fia_shade_tolerant$plot_per_hectare)) %>%
  rename("tolerance" = "X.fia_shade_tolerant.", "mean" = "mean.fia_shade_tolerant.plot_per_hectare.",
         "median" = "median.fia_shade_tolerant.plot_per_hectare.")

fia_intolerant <- data.frame("fia_shade_intolerant", mean(fia_shade_intolerant$plot_per_hectare), 
                      median(fia_shade_intolerant$plot_per_hectare)) %>%
  rename("tolerance" = "X.fia_shade_intolerant.", "mean" = "mean.fia_shade_intolerant.plot_per_hectare.",
         "median" = "median.fia_shade_intolerant.plot_per_hectare.")
##------------------------------------------------------------------------------------ 

# combine the two data frames
fia_combined_tolerance <- do.call("rbind", list(fia_tolerant, fia_intolerant))
fia_combined_tolerance$tolerance <- as.character(fia_combined_tolerance$tolerance)
fia_combined_tolerance$tolerance[fia_combined_tolerance$tolerance == "fia_shade_tolerant"] <- "Tolerant"
fia_combined_tolerance$tolerance <- as.character(fia_combined_tolerance$tolerance)
fia_combined_tolerance$tolerance[fia_combined_tolerance$tolerance == "fia_shade_intolerant"] <- "Intolerant"
##------------------------------------------------------------------------------------ 
# Graph of tolerant and intolerant densities
ggplot(fia_combined_tolerance, aes(x = tolerance, y = mean)) +
  geom_col(show.legend = FALSE) +
  labs(title = "Tree Density by Shade Tolerance", x = "Tolerance", y = "trees/ha") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  size = 20,
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     size = 10,
                                     margin=margin(10,0,0,0))) +
  theme(axis.text.x = element_text(angle = 0, size = 10)) +
  theme(axis.text.y = element_text(size = 10)) +
  theme(axis.title.y = element_text (face = "bold",
                                     size = 10,
                                     margin=margin(0,10,0,0)))+
  theme(strip.text = element_text(size=10)) 
```

# tree densiy by national forest (fia)
```{r}
# anf
fia_species_anf<- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,admin_forest, species)%>% 
  group_by(plotkey,admin_forest)%>% 
  tally() %>% 
  filter(admin_forest == "ANF") %>% 
  mutate(anf_per_hectare = (n * (1/0.067245))) 
  
mean(fia_species_anf$anf_per_hectare)
median(fia_species_anf$anf_per_hectare)
# 307.7152
# 304.8554

# create new dataframe 
total_anf_density <- data.frame("anf", mean(fia_species_anf$anf_per_hectare), median(fia_species_anf$anf_per_hectare)) %>% 
  rename ("plots" = "X.anf.", "mean trees/hectare" = "mean.fia_species_anf.anf_per_hectare.", "median trees/hectare" = "median.fia_species_anf.anf_per_hectare.")
##------------------------------------------------------------------------------------
# sbnf
fia_species_sbnf<- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,admin_forest, species)%>% 
  group_by(plotkey,admin_forest)%>% 
  tally() %>% 
  filter(admin_forest == "SBNF") %>% 
  mutate(sbnf_per_hectare = (n * (1/0.067245))) 
  
mean(fia_species_sbnf$sbnf_per_hectare)
median(fia_species_sbnf$sbnf_per_hectare)
# 375.9387
# 386.6458

# create new dataframe 
total_sbnf_density <- data.frame("sbnf", mean(fia_species_sbnf$sbnf_per_hectare), median(fia_species_sbnf$sbnf_per_hectare)) %>% 
  rename ("plots" = "X.sbnf.", "mean trees/hectare" = "mean.fia_species_sbnf.sbnf_per_hectare.", "median trees/hectare" = "median.fia_species_sbnf.sbnf_per_hectare.")
##------------------------------------------------------------------------------------
# lpnf
fia_species_lpnf<- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,admin_forest, species)%>% 
  group_by(plotkey,admin_forest)%>% 
  tally() %>% 
  filter(admin_forest == "LPNF") %>% 
  mutate(lpnf_per_hectare = (n * (1/0.067245))) 
  
mean(fia_species_lpnf$lpnf_per_hectare)
median(fia_species_lpnf$lpnf_per_hectare)
# 287.86
# 267.6779

# create new dataframe 
total_lpnf_density <- data.frame("lpnf", mean(fia_species_lpnf$lpnf_per_hectare), median(fia_species_lpnf$lpnf_per_hectare)) %>% 
  rename ("plots" = "X.lpnf.", "mean trees/hectare" = "mean.fia_species_lpnf.lpnf_per_hectare.", "median trees/hectare" = "median.fia_species_lpnf.lpnf_per_hectare.")
##------------------------------------------------------------------------------------
# cnf
fia_species_cnf<- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,admin_forest, species)%>% 
  group_by(plotkey,admin_forest)%>% 
  tally() %>% 
  filter(admin_forest == "CNF") %>% 
  mutate(cnf_per_hectare = (n * (1/0.067245)))  
# only 4 cnf plots!!  
mean(fia_species_cnf$cnf_per_hectare)
median(fia_species_cnf$cnf_per_hectare)
#260.2424
#252.8069
##------------------------------------------------------------------------------------
# join all species dataframes 
# note: cnf is not included because there are only 4 plots
NF_densities <- total_anf_density %>% 
  full_join(total_lpnf_density) %>% 
  full_join(total_sbnf_density) %>% 
  rename("mean" = "mean trees/hectare", "median" = "median trees/hectare")

# graph NF densities
ggplot(NF_densities, aes(x = plots, y = mean))+
  geom_col(show.legend = FALSE, fill = "#772055", width = 0.3) +
  geom_text(aes(label = round(mean, 1)), vjust = -0.5)+
  geom_point(aes(x = plots, y = median)) +
  theme_bw()+
  labs(title = "NF Tree Density", x = "National Forest", y = "Trees/Hectare") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 425))
```

# tree density by elevation (fia)
```{r}
# Dolanc et al. (2014) elevation classes: 0–499 m; 500–999 m; 1000–1499 m; 1500–1999 m; 2000–2499 m; ≥2500. 
# create elevation classes (in m)
fia_species_elevation <- fia_data_raw %>% 
  rename("plotkey" = "unique_plot") %>% 
  select(plotkey,species, elev) %>% 
  rename(elevation = elev) %>% 
  mutate(elevation_class = case_when (elevation <= 499.99 ~ "<499",
                                    elevation > 500 & elevation <999.99 ~ "500–999", 
                                    elevation > 1000 & elevation <1499.99 ~ "1000–1499",
                                    elevation > 1500 & elevation <1999.99 ~ "1500–1999",
                                    elevation > 2000 & elevation <2499.99 ~ "2000–2499",
                                    elevation >= "2500" ~ ">2500",
                                    TRUE ~ "none"))%>% 
  group_by(plotkey,elevation_class) %>% 
  tally() %>% 
  mutate(elevation_per_hectare = (n * (1/0.067245))) 
##------------------------------------------------------------------------------------ 

# <499
less_than_499 <- fia_species_elevation %>% 
  filter(elevation_class == "<499")
# NOTE: NO PLOTS
##------------------------------------------------------------------------------------ 

# 500–999
e_500_999 <- fia_species_elevation %>% 
  filter(elevation_class == "500–999")
# NOTE: NO PLOTS
##------------------------------------------------------------------------------------ 

# 1000–1499
e_1000_1499 <- fia_species_elevation %>% 
  filter(elevation_class == "1000–1499")
#26 plots
mean(e_1000_1499$elevation_per_hectare)
median(e_1000_1499$elevation_per_hectare)

# create new dataframe 
total_1000_1499_density <- data.frame("1000-1499", mean(e_1000_1499$elevation_per_hectare), median(e_1000_1499$elevation_per_hectare))%>% 
  rename ("plots" = "X.1000.1499.", "mean" = "mean.e_1000_1499.elevation_per_hectare.", "median" = "median.e_1000_1499.elevation_per_hectare.") 
##------------------------------------------------------------------------------------ 

# 1500–1999
e_1500_1999 <- fia_species_elevation %>% 
  filter(elevation_class == "1500–1999")
# 80 plots
mean(e_1500_1999$elevation_per_hectare)
median(e_1500_1999$elevation_per_hectare)

# create new dataframe 
total_1500_1999_density <- data.frame("1500–1999", mean(e_1500_1999$elevation_per_hectare), median(e_1500_1999$elevation_per_hectare))%>% 
  rename ("plots" = "X.1500.1999.", "mean" = "mean.e_1500_1999.elevation_per_hectare.", "median" = "median.e_1500_1999.elevation_per_hectare.")
##------------------------------------------------------------------------------------ 

# 2000–2499
e_2000_2499 <- fia_species_elevation %>% 
  filter(elevation_class == "2000–2499")
# 78 plots
mean(e_2000_2499$elevation_per_hectare)
median(e_2000_2499$elevation_per_hectare)

# create new dataframe 
total_2000_2499_density <- data.frame("2000–2499", mean(e_2000_2499$elevation_per_hectare), median(e_2000_2499$elevation_per_hectare))%>% 
  rename ("plots" = "X.2000.2499.", "mean" = "mean.e_2000_2499.elevation_per_hectare.", "median" = "median.e_2000_2499.elevation_per_hectare.")
##------------------------------------------------------------------------------------ 

# great than 2500
greater_than_2500<- fia_species_elevation %>% 
  filter(elevation_class == ">2500")
#26 plots
mean(greater_than_2500$elevation_per_hectare)
median(greater_than_2500$elevation_per_hectare)

total_greater_2500_density <- data.frame(">2500", mean(greater_than_2500$elevation_per_hectare), median(greater_than_2500$elevation_per_hectare)) %>% 
  rename ("plots" = "X..2500.", "mean" = "mean.greater_than_2500.elevation_per_hectare.", "median" = "median.greater_than_2500.elevation_per_hectare.")
##------------------------------------------------------------------------------------ 

# join all species dataframes 
elevation_densities <- total_greater_2500_density %>% 
  full_join(total_1000_1499_density) %>% 
  full_join(total_1500_1999_density) %>% 
  full_join(total_2000_2499_density)
elevation_densities$plots <- as.character(elevation_densities$plots)
class(elevation_densities$plots)
elevation_densities$plots[elevation_densities$plots == "1500–1999"]<- "1500-1999"
##------------------------------------------------------------------------------------ 

# graph 
ggplot(elevation_densities, aes(x = plots, y = mean))+
  geom_col(show.legend = FALSE, fill = "#CB8B2E", width = 0.3) +
  geom_text(aes(label = round(mean, 0)), vjust = -0.5)+
  geom_point(aes(x = plots, y = median)) +
  theme_bw()+
  labs(title = "Tree Density by Elevation", x = "Elevation (m)", y = "Trees/Hectare") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 525))
```

### VTM

# read in data (vtm)
```{r}
vtm_data <- read.table(here::here("vtm_data", "vtm_dataset_750m_buffer.txt"))
```

# total tree density (vtm)
```{r}
# select columns of interest
vtm_data_select <- vtm_data %>% 
  select(plotkey, n)%>% 
  group_by(plotkey) %>% 
  tally(n) 

# multiply n by (1/.0809) to convert to trees/hectare instead of trees/.08 hecare
vtm_data_hecare <- vtm_data_select %>% 
  mutate(tree_per_hectare = (n * (1/0.0809)))

# find the average of trees_per_hectare column
mean(vtm_data_hecare $tree_per_hectare)
median(vtm_data_hecare $tree_per_hectare)
# mode 225.7438
# median 173.0532

# create new dataframe 
total_vtm_density <- data.frame("VTM plots", mean(vtm_data_hecare$tree_per_hectare), median(vtm_data_hecare$tree_per_hectare)) %>% 
  rename ("plots" = "X.VTM.plots.", "mean" = "mean.vtm_data_hecare.tree_per_hectare.", "median" = "median.vtm_data_hecare.tree_per_hectare.")
```

# tree density by species (vtm)
```{r}
# yellow pine
# Note to Hannah: Leana created this new species after meeting on 11/10
vtm_species_yp <- vtm_data %>%
  select(abbreviation,n,plotkey)%>% 
  filter(abbreviation %in% c("PIPO", "PIJE"))%>% 
  group_by(plotkey) %>% 
  tally(n) %>% 
  mutate(tree_per_hectare = (n * (1/0.0809)))

mean(vtm_species_yp$tree_per_hectare)
median(vtm_species_yp$tree_per_hectare)
##------------------------------------------------------------------------------------ 

# pipo 
# note: this will not be included in the final data (see "yellow pine" above)
vtm_species_pipo <- vtm_data %>%
  select(abbreviation,n,plotkey) %>% 
  filter(abbreviation == "PIPO") %>% 
  group_by(plotkey) %>% # see note below
  tally(n) %>% # see note below
  mutate(tree_per_hectare = (n * (1/0.0809)))

mean(vtm_species_pipo$tree_per_hectare)
median(vtm_species_pipo$tree_per_hectare)

# these lines of code are not technically needed when dealing with one species only (because there will only ever be 1 row per plotkey, but I'll leave this in in case code is ever used for multiple species)
##------------------------------------------------------------------------------------ 

# pije
# note: this will not be included in the final data (see "yellow pine" above)
vtm_species_pije <- vtm_data %>%
  select(abbreviation,n,plotkey) %>% 
  filter(abbreviation == "PIJE") %>% 
  group_by(plotkey) %>% # see note below
  tally(n) %>% # see note below
  mutate(tree_per_hectare = (n * (1/0.0809)))

mean(vtm_species_pije$tree_per_hectare)
median(vtm_species_pije$tree_per_hectare)
# these lines of code are not technically needed when dealing with one species only (because there will only ever be 1 row per plotkey, but I'll leave this in in case code is ever used for multiple species)
##------------------------------------------------------------------------------------

# pila 
vtm_species_pila <- vtm_data %>%
  select(abbreviation,n,plotkey) %>% 
  filter(abbreviation == "PILA") %>% 
  group_by(plotkey) %>% # see note below
  tally(n) %>% # see note below
  mutate(tree_per_hectare = (n * (1/0.0809)))

mean(vtm_species_pila$tree_per_hectare)
median(vtm_species_pila$tree_per_hectare)
# these lines of code are not technically needed when dealing with one species only (because there will only ever be 1 row per plotkey, but I'll leave this in in case code is ever used for multiple species)
##------------------------------------------------------------------------------------

# pico
vtm_species_pico3 <- vtm_data %>%
  select(abbreviation,n,plotkey) %>% 
  filter(abbreviation == "PICO3") %>% 
  group_by(plotkey) %>% # see note below
  tally(n) %>%# see note below
  mutate(tree_per_hectare = (n * (1/0.0809)))

mean(vtm_species_pico3$tree_per_hectare)
median(vtm_species_pico3$tree_per_hectare)
# these lines of code are not technically needed when dealing with one species only (because there will only ever be 1 row per plotkey, but I'll leave this in in case code is ever used for multiple species)
##------------------------------------------------------------------------------------

# psma 
# note: not included in final data because there are less than 20 plots with psma in vtm data
vtm_species_psma <- vtm_data %>%
  select(abbreviation,n,plotkey) %>% 
  filter(abbreviation == "PSMA") %>% 
  group_by(plotkey) %>% # see note below
  tally(n) %>%# see note below
  mutate(tree_per_hectare = (n * (1/0.0809))) %>%
  slice(c(-14))

mean(vtm_species_psma$tree_per_hectare)
median(vtm_species_psma$tree_per_hectare)
# these lines of code are not technically needed when dealing with one species only (because there will only ever be 1 row per plotkey, but I'll leave this in in case code is ever used for multiple species)
##------------------------------------------------------------------------------------

# cade
vtm_species_cade <- vtm_data %>%
  select(abbreviation,n,plotkey) %>% 
  filter(abbreviation == "CADE") %>% 
  group_by(plotkey) %>% # see note below
  tally(n) %>%# see note below
  mutate(tree_per_hectare = (n * (1/0.0809))) %>%
  slice(c(-32))

mean(vtm_species_cade$tree_per_hectare)
median(vtm_species_cade$tree_per_hectare)
# these lines of code are not technically needed when dealing with one species only (because there will only ever be 1 row per plotkey, but I'll leave this in in case code is ever used for multiple species)
##------------------------------------------------------------------------------------

# abco 
vtm_species_abco <- vtm_data %>%
  select(abbreviation,n,plotkey) %>% 
  filter(abbreviation == "ABCO") %>% 
  group_by(plotkey) %>% # see note below
  tally(n) %>%# see note below
  mutate(tree_per_hectare = (n * (1/0.0809)))

mean(vtm_species_abco$tree_per_hectare)
median(vtm_species_abco$tree_per_hectare)
# these lines of code are not technically needed when dealing with one species only (because there will only ever be 1 row per plotkey, but I'll leave this in in case code is ever used for multiple species)
##------------------------------------------------------------------------------------

# quch 
vtm_species_quch <- vtm_data %>%
  select(abbreviation,n,plotkey) %>% 
  filter(abbreviation == "QUCH") %>% 
  group_by(plotkey) %>% # see note below
  tally(n) %>%# see note below
  mutate(tree_per_hectare = (n * (1/0.0809)))

mean(vtm_species_quch$tree_per_hectare)
median(vtm_species_quch$tree_per_hectare)
# these lines of code are not technically needed when dealing with one species only (because there will only ever be 1 row per plotkey, but I'll leave this in in case code is ever used for multiple species)
##------------------------------------------------------------------------------------

# quke 
vtm_species_quke <- vtm_data %>%
  select(abbreviation,n,plotkey) %>% 
  filter(abbreviation == "QUKE") %>% 
  group_by(plotkey) %>% # see note below
  tally(n) %>%# see note below
  mutate(tree_per_hectare = (n * (1/0.0809)))

mean(vtm_species_quke$tree_per_hectare)
median(vtm_species_quke$tree_per_hectare)
# these lines of code are not technically needed when dealing with one species only (because there will only ever be 1 row per plotkey, but I'll leave this in in case code is ever used for multiple species)
##------------------------------------------------------------------------------------

# create new dataframes 
pipo <- data.frame("pipo", mean(vtm_species_pipo$tree_per_hectare), median(vtm_species_pipo$tree_per_hectare)) %>% 
  rename ("species" = "X.pipo.", "mean" = "mean.vtm_species_pipo.tree_per_hectare.", "median" = "median.vtm_species_pipo.tree_per_hectare.")

pije <- data.frame("pije", mean(vtm_species_pije$tree_per_hectare), median(vtm_species_pije$tree_per_hectare)) %>% 
  rename ("species" = "X.pije.", "mean" = "mean.vtm_species_pije.tree_per_hectare.", "median" = "median.vtm_species_pije.tree_per_hectare.")

pila <- data.frame("pila", mean(vtm_species_pila$tree_per_hectare), median(vtm_species_pila$tree_per_hectare)) %>% 
  rename ("species" = "X.pila.", "mean" = "mean.vtm_species_pila.tree_per_hectare.", "median" = "median.vtm_species_pila.tree_per_hectare.")

pico <- data.frame("pico", mean(vtm_species_pico3$tree_per_hectare), median(vtm_species_pico3$tree_per_hectare)) %>% 
  rename ("species" = "X.pico.", "mean" = "mean.vtm_species_pico3.tree_per_hectare.", "median" = "median.vtm_species_pico3.tree_per_hectare.")

psma <- data.frame("psma", mean(vtm_species_psma$tree_per_hectare), median(vtm_species_psma$tree_per_hectare)) %>% 
  rename ("species" = "X.psma.", "mean" = "mean.vtm_species_psma.tree_per_hectare.", "median" = "median.vtm_species_psma.tree_per_hectare.")

cade <- data.frame("cade", mean(vtm_species_cade$tree_per_hectare), median(vtm_species_cade$tree_per_hectare)) %>% 
  rename ("species" = "X.cade.", "mean" = "mean.vtm_species_cade.tree_per_hectare.", "median" = "median.vtm_species_cade.tree_per_hectare.")

abco <- data.frame("abco", mean(vtm_species_abco$tree_per_hectare), median(vtm_species_abco$tree_per_hectare)) %>% 
  rename ("species" = "X.abco.", "mean" = "mean.vtm_species_abco.tree_per_hectare.", "median" = "median.vtm_species_abco.tree_per_hectare.")

quch <- data.frame("quch", mean(vtm_species_quch$tree_per_hectare), median(vtm_species_quch$tree_per_hectare)) %>% 
  rename ("species" = "X.quch.", "mean" = "mean.vtm_species_quch.tree_per_hectare.", "median" = "median.vtm_species_quch.tree_per_hectare.")

quke <- data.frame("quke", mean(vtm_species_quke$tree_per_hectare), median(vtm_species_quke$tree_per_hectare)) %>% 
  rename ("species" = "X.quke.", "mean" = "mean.vtm_species_quke.tree_per_hectare.", "median" = "median.vtm_species_quke.tree_per_hectare.")

yp <- data.frame("Yellow Pine", mean(vtm_species_yp$tree_per_hectare), median(vtm_species_yp$tree_per_hectare)) %>% 
  rename ("species" = "X.Yellow.Pine.", "mean" = "mean.vtm_species_yp.tree_per_hectare.", "median" = "median.vtm_species_yp.tree_per_hectare.")
##------------------------------------------------------------------------------------

# merge data frames of interestt together
# note: removed psma and pipo/pije. pipo/pije are captured in the yp dataframe
all_species_density <- do.call("rbind", list(abco, cade, pico, pila, quch, quke, yp)) %>% 
  rename("plots" = "species")
##------------------------------------------------------------------------------------

# Graph 
ggplot(all_species_density, aes(x = plots, y = mean)) + 
  geom_col(show.legend = FALSE) +
  labs(title = "Tree Density by Species", x = "species", y = "trees/ha") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  size = 20,
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     size = 10,
                                     margin=margin(10,0,0,0))) +
  theme(axis.text.x = element_text(angle = 0, size = 10)) +
  theme(axis.text.y = element_text(size = 10)) +
  theme(axis.title.y = element_text (face = "bold",
                                     size = 10,
                                     margin=margin(0,10,0,0)))+
  theme(strip.text = element_text(size=10))

# Comments: weird that PIPO is so high, I don't think that's right. Must have been misidentified. Also wondering if we want to rename PICO3 to just PICO? --> Leana grouped pipo and pije as yp, and renamed pico3 to pico
# Leana's response: yeah this is what we discussed as a group a few times..I think they def confused pipo/pije. We had discussed grouping these two species together, and I think we'll have to (I put it on the agenda for tomorrow)! We can also rename PICO3 to PICO, I was originally following the FIA data but I think they changed this abbreviation too. 
```

# tree density by genus (vtm)
```{r}
# pinus 
vtm_pinus <- vtm_data %>%
  select(genus, abbreviation, n, plotkey) %>%
  filter(genus == "pinus")%>%
  group_by(plotkey)%>% ## Leana added this! It is very important! (see note below)
  tally(n) %>% ## Leana added this! It is very important! (see note below)
  mutate(tree_per_hectare = (n * (1/0.0809)))

mean(vtm_pinus$tree_per_hectare)
# 129.0033
median(vtm_pinus$tree_per_hectare)
# 98.88752

## It is crucial that we have these two lines of code. Without them, one plot may be accounted for in multiple rows and so our trees per hectare calulcation would be wrong. We must make sure that only one row exists for each plotkey (the group_by code). In this case, it's very important to use "tally(n)" instead of "tally()". "tally()" will just count how many time the grouped item (plotkey) exists, while tally(n) will tally up the "n" column (number of trees) that exists for that plotkey. This same mistake occurs in the rest of the sections, so I won't continue to describe it each time. Let me know if you are still confused. It's an easy fix, but pretty important to understand!
##------------------------------------------------------------------------------------ 

# quercus
vtm_quercus <- vtm_data %>%
  select(genus, abbreviation, n, plotkey) %>%
  filter(genus == "quercus") %>%
  group_by(plotkey)%>% ## Leana added this!
  tally(n) %>% ## Leana added this!
  mutate(tree_per_hectare = (n * (1/0.0809)))

mean(vtm_quercus$tree_per_hectare)
# 152.2347
median(vtm_quercus$tree_per_hectare)
# 74.16564
##------------------------------------------------------------------------------------ 

# create new dataframes 
quercus <- data.frame("quercus", mean(vtm_quercus$tree_per_hectare), 
                      median(vtm_quercus$tree_per_hectare)) %>%
  rename("genus" = "X.quercus.", "mean" = "mean.vtm_quercus.tree_per_hectare.",
         "median" = "median.vtm_quercus.tree_per_hectare.")

pinus <- data.frame("pinus", mean(vtm_pinus$tree_per_hectare), 
                      median(vtm_pinus$tree_per_hectare)) %>%
  rename("genus" = "X.pinus.", "mean" = "mean.vtm_pinus.tree_per_hectare.",
         "median" = "median.vtm_pinus.tree_per_hectare.")
##------------------------------------------------------------------------------------ 

# merge all the data frames together
quercus_v_pinus <- do.call("rbind", list(quercus, pinus))
##------------------------------------------------------------------------------------ 

# graph of pines vs oaks
ggplot(quercus_v_pinus, aes(x = genus, y = mean)) + 
  geom_col(show.legend = FALSE) +
  labs(title = "Oak and Pine Density", x = "genus", y = "trees/ha") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  size = 20,
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     size = 10,
                                     margin=margin(10,0,0,0))) +
  theme(axis.text.x = element_text(angle = 0, size = 10)) +
  theme(axis.text.y = element_text(size = 10)) +
  theme(axis.title.y = element_text (face = "bold",
                                     size = 10,
                                     margin=margin(0,10,0,0)))+
  theme(strip.text = element_text(size=10))
```

# tree density by shade tolerant/intolerant (vtm)
```{r}
# Shade Tolerant species: PILA, ABCO, CADE, QUCH
# Shade Intolerant species: PIPO, PIJE, PICO, PSMA, QUKE

# Note:unsure if this is how the final species list for shade tolerant and intolerant will look like - hgw
##------------------------------------------------------------------------------------ 

# create a column for shade tolerant. 
# 1 = yes, shade tolerant. 
# 0 = no, shade intolerant
vtm_shade <- vtm_data %>%
  select(plotkey, abbreviation, n) %>%
  mutate(shade_tolerant = ifelse(abbreviation %in% c("PILA",
                                                     "ABCO",
                                                     "CADE",
                                                     "QUCH"), "1",
                                 ifelse(abbreviation %in% c("PIPO",
                                                            "PIJE",
                                                            "PICO3",
                                                            "PSMA",
                                                            "QUKE"), "0", "NA")))%>%
  group_by(plotkey, shade_tolerant) %>%
  tally(n)
##------------------------------------------------------------------------------------ 

# find shade-tolerant density
vtm_shade_tolerant <- vtm_shade %>%
  filter(shade_tolerant == "1") %>%
  mutate(plot_per_hectare = (n * (1/0.0809)))

mean(vtm_shade_tolerant$plot_per_hectare)
# 152.804
median(vtm_shade_tolerant$plot_per_hectare)
# 105.068
##------------------------------------------------------------------------------------ 

# find shade-intolerant density
vtm_shade_intolerant <- vtm_shade %>%
  filter(shade_tolerant == "0") %>%
  mutate(plot_per_hectare = (n * (1/0.0809)))

mean(vtm_shade_intolerant$plot_per_hectare)
# 143.9117
median(vtm_shade_intolerant$plot_per_hectare)
# 111.2485
##------------------------------------------------------------------------------------ 

# make dataframes 
tolerant <- data.frame("vtm_shade_tolerant", mean(vtm_shade_tolerant$plot_per_hectare), 
                      median(vtm_shade_tolerant$plot_per_hectare)) %>%
  rename("tolerance" = "X.vtm_shade_tolerant.", "mean" = "mean.vtm_shade_tolerant.plot_per_hectare.",
         "median" = "median.vtm_shade_tolerant.plot_per_hectare.")

intolerant <- data.frame("vtm_shade_intolerant", mean(vtm_shade_intolerant$plot_per_hectare), 
                      median(vtm_shade_intolerant$plot_per_hectare)) %>%
  rename("tolerance" = "X.vtm_shade_intolerant.", "mean" = "mean.vtm_shade_intolerant.plot_per_hectare.",
         "median" = "median.vtm_shade_intolerant.plot_per_hectare.")
##------------------------------------------------------------------------------------ 

# combine the two data frames
combined_tolerance <- do.call("rbind", list(tolerant, intolerant))
combined_tolerance$tolerance <- as.character(combined_tolerance$tolerance)
combined_tolerance$tolerance[combined_tolerance$tolerance == "vtm_shade_intolerant"] <- "Intolerant"
combined_tolerance$tolerance[combined_tolerance$tolerance == "vtm_shade_tolerant"] <- "Tolerant"
##------------------------------------------------------------------------------------ 
# Graph of tolerant and intolerant densities
ggplot(combined_tolerance, aes(x = tolerance, y = mean)) +
  geom_col(show.legend = FALSE) +
  labs(title = "Tree Density by Shade Tolerance", x = "Tolerance", y = "trees/ha") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  size = 20,
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     size = 10,
                                     margin=margin(10,0,0,0))) +
  theme(axis.text.x = element_text(angle = 0, size = 10)) +
  theme(axis.text.y = element_text(size = 10)) +
  theme(axis.title.y = element_text (face = "bold",
                                     size = 10,
                                     margin=margin(0,10,0,0)))+
  theme(strip.text = element_text(size=10)) 
```

# tree density by national forest (vtm)
```{r}
# anf 
vtm_anf <- vtm_data %>%
  select(national_forest_name, plotkey, n) %>%
  group_by(plotkey, national_forest_name)%>% 
  tally(n) %>% ## Leana fixed this line of code. Very important!
  filter(national_forest_name == "anf") %>% 
  mutate(anf_per_hectare = (n * (1/0.0809))) 

mean(vtm_anf$anf_per_hectare)
median(vtm_anf$anf_per_hectare)
##------------------------------------------------------------------------------------

# sbnf 
vtm_sbnf <- vtm_data %>%
  select(national_forest_name, plotkey, n) %>%
  group_by(plotkey, national_forest_name)%>% 
  tally(n) %>% ## Leana fixed this line of code. 
  filter(national_forest_name == "sbnf") %>% 
  mutate(sbnf_per_hectare = (n * (1/0.0809))) 

mean(vtm_sbnf$sbnf_per_hectare)
median(vtm_sbnf$sbnf_per_hectare)
##------------------------------------------------------------------------------------

# lpnf 
vtm_lpnf <- vtm_data %>%
  select(national_forest_name, plotkey, n) %>%
  group_by(plotkey, national_forest_name)%>% 
  tally(n) %>% ## Leana fixed this line of code. 
  filter(national_forest_name == "lpnf") %>% 
  mutate(lpnf_per_hectare = (n * (1/0.0809))) 

mean(vtm_lpnf$lpnf_per_hectare)
median(vtm_lpnf$lpnf_per_hectare)
##------------------------------------------------------------------------------------

# cnf 
vtm_cnf <- vtm_data %>%
  select(national_forest_name, plotkey, n) %>%
  group_by(plotkey, national_forest_name)%>% 
  tally(n) %>% ## Leana fixed this line of code. 
  filter(national_forest_name == "cnf") %>% 
  mutate(cnf_per_hectare = (n * (1/0.0809))) 
# note only 2 plots from cnf--> small sample size
mean(vtm_cnf$cnf_per_hectare)
median(vtm_cnf$cnf_per_hectare)
##------------------------------------------------------------------------------------

# create new data frames combining all national forest densities
anf <- data.frame("anf", mean(vtm_anf$anf_per_hectare), 
                      median(vtm_anf$anf_per_hectare)) %>%
  rename("forest" = "X.anf.", "mean" = "mean.vtm_anf.anf_per_hectare.",
         "median" = "median.vtm_anf.anf_per_hectare.")

sbnf <- data.frame("sbnf", mean(vtm_sbnf$sbnf_per_hectare), 
                      median(vtm_sbnf$sbnf_per_hectare)) %>%
  rename("forest" = "X.sbnf.", "mean" = "mean.vtm_sbnf.sbnf_per_hectare.",
         "median" = "median.vtm_sbnf.sbnf_per_hectare.")

lpnf <- data.frame("lpnf", mean(vtm_lpnf$lpnf_per_hectare), 
                      median(vtm_lpnf$lpnf_per_hectare)) %>%
  rename("forest" = "X.lpnf.", "mean" = "mean.vtm_lpnf.lpnf_per_hectare.",
         "median" = "median.vtm_lpnf.lpnf_per_hectare.")

cnf <- data.frame("cnf", mean(vtm_cnf$cnf_per_hectare), 
                      median(vtm_cnf$cnf_per_hectare)) %>%
  rename("forest" = "X.cnf.", "mean" = "mean.vtm_cnf.cnf_per_hectare.",
         "median" = "median.vtm_cnf.cnf_per_hectare.")
##------------------------------------------------------------------------------------

# merge all the data frames together
# note: we did not include cnf, because only had data from 2 plots
forest_density <- do.call("rbind", list(anf, sbnf, lpnf))
##------------------------------------------------------------------------------------

# Graph of national forest density
ggplot(forest_density, aes(x = forest, y = mean)) +
  geom_col(show.legend = FALSE) +
  labs(title = "Tree Density by National Forest", x = "national forest", y = "trees/ha") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  size = 20,
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     size = 10,
                                     margin=margin(10,0,0,0))) +
  theme(axis.text.x = element_text(angle = 0, size = 10)) +
  theme(axis.text.y = element_text(size = 10)) +
  theme(axis.title.y = element_text (face = "bold",
                                     size = 10,
                                     margin=margin(0,10,0,0)))+
  theme(strip.text = element_text(size=10)) 

```

# tree density by elevation (vtm)
```{r}
# Select columns of interest and create elevation classes
vtm_elevation <- vtm_data %>%
  select(plotkey, elevation, abbreviation, n) %>%
  mutate(elevation_m = (elevation/3.28084)) %>% 
  mutate(elevation_class = case_when (elevation_m <= 499 ~ "<499",
                                    elevation_m > 500 & elevation_m <999.99 ~ "500–999", 
                                    elevation_m > 1000 & elevation_m <1499.99 ~ "1000–1499",
                                    elevation_m > 1500 & elevation_m <1999.99 ~ "1500–1999",
                                    elevation_m > 2000 & elevation_m <2499.99 ~ "2000–2499",
                                    elevation_m >= "2500" ~ ">2500",
                                    TRUE ~ "none"))%>% 
  group_by(plotkey,elevation_class) %>% 
  tally(n) %>% ## Leana added this
  mutate(elevation_per_hectare = (n * (1/0.0809))) 
##------------------------------------------------------------------------------------

# <499
vtm_less_than_499 <- vtm_elevation %>% 
  filter(elevation_class == "<499")
# NOTE: NO PLOTS
##------------------------------------------------------------------------------------

# 500–999
vtm_e_500_999 <- vtm_elevation %>% 
  filter(elevation_class == "500–999")
# NOTE: NO PLOTS
##------------------------------------------------------------------------------------

# 1000–1499
vtm_e_1000_1499 <- vtm_elevation %>% 
  filter(elevation_class == "1000–1499")
#25 plots
mean(vtm_e_1000_1499$elevation_per_hectare)
median(vtm_e_1000_1499$elevation_per_hectare)

# create new dataframe 
vtm_1000_1499_density <- data.frame("1000-1499", mean(vtm_e_1000_1499$elevation_per_hectare), median(vtm_e_1000_1499$elevation_per_hectare))%>% 
  rename ("plots" = "X.1000.1499.", "mean" = "mean.vtm_e_1000_1499.elevation_per_hectare.", "median" = "median.vtm_e_1000_1499.elevation_per_hectare.") 
##------------------------------------------------------------------------------------

# 1500–1999
vtm_e_1500_1999 <- vtm_elevation %>% 
  filter(elevation_class == "1500–1999")
#97 plots
mean(vtm_e_1500_1999$elevation_per_hectare)
median(vtm_e_1500_1999$elevation_per_hectare)

# create new dataframe 
vtm_1500_1999_density <- data.frame("1500-1999", mean(vtm_e_1500_1999$elevation_per_hectare), median(vtm_e_1500_1999$elevation_per_hectare))%>% 
  rename ("plots" = "X.1500.1999.", "mean" = "mean.vtm_e_1500_1999.elevation_per_hectare.", "median" = "median.vtm_e_1500_1999.elevation_per_hectare.") 
##------------------------------------------------------------------------------------

# 2000–2499
vtm_e_2000_2499<- vtm_elevation %>% 
  filter(elevation_class == "2000–2499")
#81 plots
mean(vtm_e_2000_2499$elevation_per_hectare)
median(vtm_e_2000_2499$elevation_per_hectare)

# create new dataframe 
vtm_2000_2499_density <- data.frame("2000–2499", mean(vtm_e_2000_2499$elevation_per_hectare), median(vtm_e_2000_2499$elevation_per_hectare))%>% 
  rename ("plots" = "X.2000.2499.", "mean" = "mean.vtm_e_2000_2499.elevation_per_hectare.", "median" = "median.vtm_e_2000_2499.elevation_per_hectare.") 
##------------------------------------------------------------------------------------

# greater than 2500
vtm_greater_than_2500<- vtm_elevation %>% 
  filter(elevation_class == ">2500")
#13 plots
mean(vtm_greater_than_2500$elevation_per_hectare)
median(vtm_greater_than_2500$elevation_per_hectare)

total_vtm_greater_2500_density <- data.frame(">2500", mean(vtm_greater_than_2500$elevation_per_hectare), median(vtm_greater_than_2500$elevation_per_hectare)) %>% 
  rename ("plots" = "X..2500.", "mean" = "mean.vtm_greater_than_2500.elevation_per_hectare.", "median" = "median.vtm_greater_than_2500.elevation_per_hectare.")
##------------------------------------------------------------------------------------

# join all species dataframes 
vtm_elevation_densities <- total_vtm_greater_2500_density %>% 
  full_join(vtm_1000_1499_density) %>% 
  full_join(vtm_1500_1999_density) %>% 
  full_join(vtm_2000_2499_density)
```

### Combined VTM and FIA graphs

# total tree density (combined)
```{r}
#total_density: fia data
#total__vtm density: vtm data
##------------------------------------------------------------------------------------

# add columns to specify data source (vtm or fia)
total_density_2 <- total_density %>% 
  select(-plots) %>% 
  mutate(type = "FIA") %>% 
  mutate(plots = "1")

total_vtm_density_2 <- total_vtm_density %>% 
  select(-plots) %>% 
  mutate(type = "VTM") %>% 
  mutate(plots = "2")
##------------------------------------------------------------------------------------

# combine vtm and fia data
combined_total_density <- total_density_2 %>% 
  full_join(total_vtm_density_2) 
##------------------------------------------------------------------------------------  

# create a factor orders
total_fill_order <- c("VTM", "FIA")
total_order <- c("2", "1")
##------------------------------------------------------------------------------------

# make graph
ggplot(combined_total_density,aes(x=factor(plots, total_order),y=mean,fill=factor(type, total_fill_order)))+
  scale_fill_manual(values = c("#8EBB90", "#1D734D"), labels=c("VTM", "FIA"), name = "Date source") +
  geom_col(position=position_dodge(width=0.9), width = 0.4, stat="identity")+
  geom_text(aes(label=round(mean, 0)), position=position_dodge(width=0.9), vjust=-1.2, size = 4)+
  geom_point(aes(x = plots, y = median), position=position_dodge(width=0.9), vjust=-0.3) +
  theme_bw()+
  labs(title = "YPMC Tree Density", x = "Species", y = "Trees/Hectare") +
   theme(axis.text.x=element_blank(), axis.ticks.x=element_blank())+
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  #theme(aspect.ratio = .2)+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 400))
```

# tree density by species (combined)
```{r}
# Note: We have removed PSMA (present in less than 20 vtm plots) & grouped PIPO and PIJE under "yellow pine"
# species_densities = FIA data
# all_species_density = VTM data
##------------------------------------------------------------------------------------

# add columns to specify data source (vtm or fia)
species_densities_2 <- species_densities %>% 
  mutate(type = "fia")
all_species_density_2 <- all_species_density %>% 
  mutate(type = "vtm")
##------------------------------------------------------------------------------------

# combine vtm and fia data
combined_species <-species_densities_2 %>% 
  full_join(all_species_density_2)
##------------------------------------------------------------------------------------

# rename tree species
combined_species$plots <- as.character(combined_species$plots)

combined_species$plots[combined_species$plots == "abco"] <-"ABCO"
combined_species$plots[combined_species$plots == "cade"] <-"CADE"
combined_species$plots[combined_species$plots == "pico"] <-"PICO"
combined_species$plots[combined_species$plots == "pila"] <-"PILA"
combined_species$plots[combined_species$plots == "quch"] <-"QUCH"
combined_species$plots[combined_species$plots == "quke"] <-"QUKE"
##------------------------------------------------------------------------------------

# create a factor order
species_order <- c("vtm", "fia")
##------------------------------------------------------------------------------------

# make graph
ggplot(combined_species,aes(x=plots,y=mean,fill=factor(type, species_order)))+
  scale_fill_manual(values = c("#8EBB90", "#1D734D"), labels=c("VTM", "FIA"), name = "Date source")+
  geom_col(stat="identity",position=position_dodge(width=0.9))+
  geom_text(aes(label=round(mean, 0)), position=position_dodge(width=0.9), vjust=-1.2, size = 3)+
  geom_point(aes(x = plots, y = median), position=position_dodge(width=0.9), vjust=-0.3) +
  theme_bw()+
  labs(title = "YPMC Tree Density", x = "Species", y = "Trees/Hectare") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 250))


```

# tree density by genus (combined)
```{r}
# oak_pine_densities = FIA data
# quercus_v_pinus = VTM data
##------------------------------------------------------------------------------------

# add columns to specify data source (vtm or fia) and rename appropriately
oak_pine_densities_2 <- oak_pine_densities %>% 
  mutate(type = "fia")
oak_pine_densities_2$plots <- as.character(oak_pine_densities_2$plots)
oak_pine_densities_2$plots[oak_pine_densities_2$plots == "pine"]<- "Pine"
oak_pine_densities_2$plots[oak_pine_densities_2$plots == "oak"]<- "Oak"

quercus_v_pinus_2 <- quercus_v_pinus %>% 
  mutate(type = "vtm") %>% 
  rename("plots" = "genus")
quercus_v_pinus_2$plots <- as.character(quercus_v_pinus_2$plots)
quercus_v_pinus_2$plots[quercus_v_pinus_2$plots == "pinus"]<- "Pine"
quercus_v_pinus_2$plots[quercus_v_pinus_2$plots == "quercus"]<- "Oak"
##------------------------------------------------------------------------------------

# combine vtm and fia data
combined_oaks_pines <-oak_pine_densities_2 %>% 
  full_join(quercus_v_pinus_2)
##------------------------------------------------------------------------------------

# create a factor order
species_order <- c("vtm", "fia")
##------------------------------------------------------------------------------------

# make graph
ggplot(combined_oaks_pines,aes(x=plots,y=mean,fill=factor(type, species_order)))+
  scale_fill_manual(values = c("#8EBB90", "#1D734D"), labels=c("VTM", "FIA"), name = "Date source")+
  geom_col(stat="identity",position=position_dodge(width = 0.4), width = 0.4)+
  geom_text(aes(label=round(mean, 0)), position=position_dodge(width = 0.4), vjust=-1.2, size = 4)+
  geom_point(aes(x = plots, y = median), position=position_dodge(width = 0.4), vjust=-0.3) +
  theme_bw()+
  labs(title = "YPMC Tree Density", x = "Genus", y = "Trees/Hectare") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 250))
```

# tree density by shade tolerant/intolerant (combined)
```{r}
# fia_combined_tolerance
# combined_tolerance: vtm data
##------------------------------------------------------------------------------------

# add columns to specify data source (vtm or fia) 
fia_combined_tolerance_2 <- fia_combined_tolerance%>% 
  mutate(type = "fia")


combined_tolerance_2 <- combined_tolerance %>% 
  mutate(type = "vtm") 
##------------------------------------------------------------------------------------

# combine vtm and fia data
combined_shade_tolerances <-fia_combined_tolerance_2 %>% 
  full_join(combined_tolerance_2)
##------------------------------------------------------------------------------------

# create a factor order
species_order <- c("vtm", "fia")
##------------------------------------------------------------------------------------

# make graph
ggplot(combined_shade_tolerances,aes(x=tolerance,y=mean,fill=factor(type, species_order)))+
  scale_fill_manual(values = c("#8EBB90", "#1D734D"), labels=c("VTM", "FIA"), name = "Date source")+
  geom_col(stat="identity",position=position_dodge(width = 0.4), width = 0.4)+
  geom_text(aes(label=round(mean, 0)), position=position_dodge(width = 0.4), vjust=-1.2, size = 4)+
  geom_point(aes(x = tolerance, y = median), position=position_dodge(width = 0.4), vjust=-0.3) +
  theme_bw()+
  labs(title = "YPMC Tree Density", x = "Shade Tolerance", y = "Trees/Hectare") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 250))
```

# tree density by national forest (combined)
```{r}
# Note: We have removed CNF because there were only 2 vtm plots and 4 fia plots
# NF_densities = FIA data
# forest_density = VTM data
##------------------------------------------------------------------------------------

# add columns to specify data source (vtm or fia) and rename appropriately
NF_densities_2 <- NF_densities %>% 
  mutate(type = "fia")
NF_densities_2$plots <- as.character(NF_densities_2$plots)
NF_densities_2$plots[NF_densities_2$plots == "anf"]<- "ANF"
NF_densities_2$plots[NF_densities_2$plots == "lpnf"]<- "LPNF"
NF_densities_2$plots[NF_densities_2$plots == "sbnf"]<- "SBNF"

forest_density_2 <- forest_density %>% 
  mutate(type = "vtm") %>% 
  rename ("plots" = "forest")
forest_density_2$plots <- as.character(forest_density_2$plots)
forest_density_2$plots[forest_density_2$plots == "anf"]<- "ANF"
forest_density_2$plots[forest_density_2$plots == "lpnf"]<- "LPNF"
forest_density_2$plots[forest_density_2$plots == "sbnf"]<- "SBNF"
##------------------------------------------------------------------------------------

# combine vtm and fia data
combined_NF <-NF_densities_2 %>% 
  full_join(forest_density_2)
##------------------------------------------------------------------------------------

# create a factor order
species_order <- c("vtm", "fia")
##------------------------------------------------------------------------------------

# make graph
ggplot(combined_NF,aes(x=plots,y=mean,fill=factor(type, species_order)))+
  scale_fill_manual(values = c("#8EBB90", "#1D734D"), labels=c("VTM", "FIA"), name = "Date source")+
  geom_col(stat="identity",position=position_dodge(width = 0.4), width = 0.4)+
  geom_text(aes(label=round(mean, 0)), position=position_dodge(width = 0.4), vjust=-1.2, size = 4)+
  geom_point(aes(x = plots, y = median), position=position_dodge(width = 0.4), vjust=-0.3) +
  theme_bw()+
  labs(title = "YPMC Tree Density", x = "National Forest", y = "Trees/Hectare") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 450))
```

# tree density by elevation (combined)
```{r}
# Note: There are only 13 vtm plots in the >2500 elevation class--> we have decided to keep this size class and just note the small sample size for the vtm data
# elevation_densities = FIA data
# vtm_elevation_densities = VTM data
##------------------------------------------------------------------------------------
# add columns to specify data source (vtm or fia) and rename appropriately
elevation_densities_2 <- elevation_densities %>% 
  mutate(type = "fia")

vtm_elevation_densities_2 <- vtm_elevation_densities %>% 
  mutate(type = "vtm") 
##------------------------------------------------------------------------------------

# combine vtm and fia data
combined_elevation <-elevation_densities_2 %>% 
  full_join(vtm_elevation_densities_2)

combined_elevation$plots <- as.character(combined_elevation$plots)
##------------------------------------------------------------------------------------

# create a factor order
species_order <- c("vtm", "fia")
el_order <- c("1000-1499", "1500-1999", "2000–2499", ">2500")

##------------------------------------------------------------------------------------

# make graph
ggplot(combined_elevation,aes(x=factor(plots, el_order),y=mean,fill=factor(type, species_order)))+
  scale_fill_manual(values = c("#8EBB90", "#1D734D"), labels=c("VTM", "FIA"), name = "Date source")+
  geom_col(stat="identity",position=position_dodge(width = 0.4), width = 0.4)+
  geom_text(aes(label=round(mean, 0)), position=position_dodge(width = 0.4), vjust=-1.2, size = 4)+
  geom_point(aes(x = plots, y = median), position=position_dodge(width = 0.4), vjust=-0.3) +
  theme_bw()+
  labs(title = "YPMC Tree Density", x = "Elevation (m)", y = "Trees/Hectare") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 450))
```

# combined
```{r}
# dataframes to combine
combined_total_density_2 <-combined_total_density
combined_total_density_2$plots[combined_total_density_2$plots == "1"] <- "All Species"
combined_total_density_2$plots[combined_total_density_2$plots == "2"] <- "All Species" 
combined_total_density_2$type[combined_total_density_2$type == "FIA"] <- "fia"  
combined_total_density_2$type[combined_total_density_2$type == "VTM"] <- "vtm"  
# combined_oaks_pines 
##------------------------------------------------------------------------------------

# combine dataframes
combined_density_breakdown <-combined_total_density_2 %>% 
  full_join(combined_oaks_pines)
##------------------------------------------------------------------------------------

# create a factor order
combined_order <- c("Pine", "Oak", "All Species")
type_order <- c("vtm", "fia")
##------------------------------------------------------------------------------------

# make graph #1
ggplot(combined_density_breakdown,aes(x=factor(type, type_order),y=mean,fill=factor(plots, combined_order)))+
  scale_fill_manual(values = c("#DF869C", "#982845","#6D182D" ), labels=c("Pine", "Oak", "All Species"), name = "Species")+
  geom_col(stat="identity",position=position_dodge(width = 0.4), width = 0.4)+
  geom_text(aes(label=round(mean, 0)), position=position_dodge(width = 0.4), vjust=-1.2, size = 4)+
  geom_point(aes(x = type, y = median), position=position_dodge(width = 0.4), vjust=-0.3) +
  theme_bw()+
  labs(title = "YPMC Tree Density", x = "", y = "Trees/Hectare") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 450))

## interpretation of vtm data: when pines were found in the plots, their average density was 129 trees/hectare. The average density of oaks across the plots they were found in was 152 trees/hectare. The average density of all YPMC species was 226 

##------------------------------------------------------------------------------------

# make graph #2
# dataset to use:combined_density_breakdown#
order <- c("vtm", "fia")

ggplot(combined_density_breakdown,aes(x=plots,y=mean,fill=factor(type, species_order)))+
  scale_fill_manual(values = c("#8EBB90", "#1D734D"), labels=c("VTM", "FIA"), name = "Date source")+
  geom_col(stat="identity",position=position_dodge(width = 0.4), width = 0.4)+
  geom_text(aes(label=round(mean, 0)), position=position_dodge(width = 0.4), vjust=-1.2, size = 4)+
  geom_point(aes(x = plots, y = median), position=position_dodge(width = 0.4), vjust=-0.3) +
  theme_bw()+
  labs(title = "YPMC Tree Density", x = "Species", y = "Trees/Hectare") +
  theme(plot.title = element_text(hjust= 0.5,
                                  face = "bold",
                                  margin=margin(0,0,10,0))) +
  theme(axis.title.x = element_text (face = "bold",
                                     margin=margin(10,0,0,0))) +
  theme(axis.title.y = element_text (face = "bold",
                                     margin=margin(0,10,0,0)))+
  scale_y_continuous( expand = c(0,0))+
  expand_limits(y = c(0, 450))

# Leana's Notes: IDK if these graphs are useful? Maybe some sort of percentage graphs would be useful?
```

